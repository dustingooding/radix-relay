<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Radix Relay: lib/nostr/include/nostr/message_handler.hpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Radix Relay
   </div>
   <div id="projectbrief">Hybrid mesh communications with Signal Protocol encryption</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function() { init_codefold(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('message__handler_8hpp_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">message_handler.hpp</div></div>
</div><!--header-->
<div class="contents">
<a href="message__handler_8hpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="preprocessor">#pragma once</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span> </div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="preprocessor">#include &lt;bit&gt;</span></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="preprocessor">#include &lt;<a class="code" href="core_2include_2concepts_2signal__bridge_8hpp.html">concepts/signal_bridge.hpp</a>&gt;</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="preprocessor">#include &lt;<a class="code" href="core_2include_2core_2events_8hpp.html">core/events.hpp</a>&gt;</span></div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="preprocessor">#include &lt;<a class="code" href="core_2include_2core_2semver__utils_8hpp.html">core/semver_utils.hpp</a>&gt;</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="preprocessor">#include &lt;ctime&gt;</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="preprocessor">#include &lt;fmt/format.h&gt;</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="preprocessor">#include &lt;internal_use_only/config.hpp&gt;</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="preprocessor">#include &lt;iterator&gt;</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="preprocessor">#include &lt;nlohmann/json.hpp&gt;</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="preprocessor">#include &lt;<a class="code" href="nostr_2include_2nostr_2events_8hpp.html">nostr/events.hpp</a>&gt;</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="preprocessor">#include &lt;<a class="code" href="protocol_8hpp.html">nostr/protocol.hpp</a>&gt;</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="preprocessor">#include &lt;<a class="code" href="nostr_2include_2nostr_2semver__utils_8hpp.html">nostr/semver_utils.hpp</a>&gt;</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="preprocessor">#include &lt;optional&gt;</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="preprocessor">#include &lt;spdlog/spdlog.h&gt;</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span> </div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="keyword">namespace </span><a class="code hl_namespace" href="namespaceradix__relay_1_1nostr.html">radix_relay::nostr</a> {</div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span> </div>
<div class="foldopen" id="foldopen00027" data-start="{" data-end="};">
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno"><a class="line" href="structradix__relay_1_1nostr_1_1publish__bundle__result.html">   27</a></span><span class="keyword">struct </span><a class="code hl_struct" href="structradix__relay_1_1nostr_1_1publish__bundle__result.html">publish_bundle_result</a></div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span>{</div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno"><a class="line" href="structradix__relay_1_1nostr_1_1publish__bundle__result.html#a06567c37b9b3f6336a4fb22f47c5f7c1">   29</a></span>  std::string <a class="code hl_variable" href="structradix__relay_1_1nostr_1_1publish__bundle__result.html#a06567c37b9b3f6336a4fb22f47c5f7c1">event_id</a>;</div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno"><a class="line" href="structradix__relay_1_1nostr_1_1publish__bundle__result.html#aa1a52150045908833b9d557a7b741d9d">   30</a></span>  std::vector&lt;std::byte&gt; <a class="code hl_variable" href="structradix__relay_1_1nostr_1_1publish__bundle__result.html#aa1a52150045908833b9d557a7b741d9d">bytes</a>;</div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno"><a class="line" href="structradix__relay_1_1nostr_1_1publish__bundle__result.html#a43c10fe0c6b8cbc0c45c0a33d8f9d9e1">   31</a></span>  std::uint32_t <a class="code hl_variable" href="structradix__relay_1_1nostr_1_1publish__bundle__result.html#a43c10fe0c6b8cbc0c45c0a33d8f9d9e1">pre_key_id</a>;</div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno"><a class="line" href="structradix__relay_1_1nostr_1_1publish__bundle__result.html#a5235a454dc24193251da6682822bbbce">   32</a></span>  std::uint32_t <a class="code hl_variable" href="structradix__relay_1_1nostr_1_1publish__bundle__result.html#a5235a454dc24193251da6682822bbbce">signed_pre_key_id</a>;</div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno"><a class="line" href="structradix__relay_1_1nostr_1_1publish__bundle__result.html#a14e46ee80d285ac733d658dfc042eef0">   33</a></span>  std::uint32_t <a class="code hl_variable" href="structradix__relay_1_1nostr_1_1publish__bundle__result.html#a14e46ee80d285ac733d658dfc042eef0">kyber_pre_key_id</a>;</div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span>};</div>
</div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span> </div>
<div class="foldopen" id="foldopen00044" data-start="{" data-end="};">
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno"><a class="line" href="classradix__relay_1_1nostr_1_1message__handler.html">   44</a></span><span class="keyword">template</span>&lt;concepts::signal_br<span class="keywordtype">id</span>ge Br<span class="keywordtype">id</span>ge&gt; <span class="keyword">class </span><a class="code hl_class" href="classradix__relay_1_1nostr_1_1message__handler.html">message_handler</a></div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span>{</div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span><span class="keyword">public</span>:</div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno"><a class="line" href="classradix__relay_1_1nostr_1_1message__handler.html#a5b082f2c844f0adf08e0182e2a3ba163">   52</a></span>  <span class="keyword">explicit</span> <a class="code hl_function" href="classradix__relay_1_1nostr_1_1message__handler.html#a5b082f2c844f0adf08e0182e2a3ba163">message_handler</a>(std::shared_ptr&lt;Bridge&gt; bridge) : bridge_(bridge) {}</div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span> </div>
<div class="foldopen" id="foldopen00060" data-start="{" data-end="}">
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno"><a class="line" href="classradix__relay_1_1nostr_1_1message__handler.html#a5d81a483421e8c8bcc9c5a18591251dd">   60</a></span>  [[nodiscard]] <span class="keyword">auto</span> <a class="code hl_function" href="classradix__relay_1_1nostr_1_1message__handler.html#a5d81a483421e8c8bcc9c5a18591251dd">handle</a>(<span class="keyword">const</span> <a class="code hl_struct" href="structradix__relay_1_1nostr_1_1events_1_1incoming_1_1encrypted__message.html">nostr::events::incoming::encrypted_message</a> &amp;event)</div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>    -&gt; std::optional&lt;core::events::message_received&gt;</div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>  {</div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>    std::vector&lt;uint8_t&gt; encrypted_bytes;</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>    <span class="keyword">constexpr</span> <span class="keywordtype">int</span> hex_base = 16;</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; <span class="keyword">event</span>.content.length(); i += 2) {</div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>      <span class="keyword">auto</span> byte_string = <span class="keyword">event</span>.content.substr(i, 2);</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>      <span class="keyword">auto</span> byte_value = <span class="keyword">static_cast&lt;</span>uint8_t<span class="keyword">&gt;</span>(std::stoul(byte_string, <span class="keyword">nullptr</span>, hex_base));</div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>      encrypted_bytes.push_back(byte_value);</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>    }</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span> </div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>    <span class="comment">// Pass Nostr pubkey as peer_hint - decrypt_message will:</span></div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>    <span class="comment">// - For PreKeySignalMessage: extract identity key and create contact automatically</span></div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>    <span class="comment">// - For SignalMessage: look up existing contact by this pubkey</span></div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>    <span class="keyword">auto</span> result = bridge_-&gt;decrypt_message(event.pubkey, encrypted_bytes);</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span> </div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>    <span class="keyword">const</span> std::string decrypted_content(result.plaintext.begin(), result.plaintext.end());</div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span> </div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>    bridge_-&gt;update_last_message_timestamp(event.created_at);</div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span> </div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>    <span class="comment">// After successful decryption, get the sender&#39;s contact info (now guaranteed to exist)</span></div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>    <span class="keyword">auto</span> sender_contact = bridge_-&gt;lookup_contact(event.pubkey);</div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span> </div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>    <span class="keywordflow">return</span> <a class="code hl_struct" href="structradix__relay_1_1core_1_1events_1_1message__received.html">core::events::message_received</a>{ .<a class="code hl_variable" href="structradix__relay_1_1core_1_1events_1_1message__received.html#ab0a91e4cf64de1ba529c79883b47c9d6">sender_rdx</a> = sender_contact.rdx_fingerprint,</div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>      .sender_alias = sender_contact.user_alias,</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>      .content = decrypted_content,</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>      .timestamp = <span class="keyword">event</span>.created_at,</div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>      .should_republish_bundle = result.should_republish_bundle };</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>  }</div>
</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span> </div>
<div class="foldopen" id="foldopen00097" data-start="{" data-end="}">
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno"><a class="line" href="classradix__relay_1_1nostr_1_1message__handler.html#a9e24647bad00caee8f44e26472327d59">   97</a></span>  [[nodiscard]] <span class="keyword">static</span> <span class="keyword">auto</span> <a class="code hl_function" href="classradix__relay_1_1nostr_1_1message__handler.html#a9e24647bad00caee8f44e26472327d59">handle</a>(<span class="keyword">const</span> <a class="code hl_struct" href="structradix__relay_1_1nostr_1_1events_1_1incoming_1_1bundle__announcement.html">nostr::events::incoming::bundle_announcement</a> &amp;event) -&gt; std::optional&lt;</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>    std::variant&lt;core::events::bundle_announcement_received, core::events::bundle_announcement_removed&gt;&gt;</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>  {</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>    <span class="keyword">auto</span> version = <a class="code hl_function" href="namespaceradix__relay_1_1nostr.html#afc61f07b63e28b68f812eaeee1f2e5a6">nostr::extract_version_from_tags</a>(event.tags);</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>    <span class="keywordflow">if</span> (not version.has_value()) { <span class="keywordflow">return</span> std::nullopt; }</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span> </div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>    <span class="keywordflow">if</span> (not <a class="code hl_function" href="namespaceradix__relay_1_1core.html#a878296935424282b4081eebd803dc192">core::is_version_compatible</a>(version.value(), <a class="code hl_variable" href="namespaceradix__relay_1_1nostr_1_1protocol.html#a07dd2beffb69fcfff52b2d087e36b972">protocol::bundle_announcement_minimum_version</a>)) {</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>      <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>    }</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span> </div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>    <span class="keywordflow">if</span> (event.content.empty()) {</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>      <span class="keywordflow">return</span> <a class="code hl_struct" href="structradix__relay_1_1core_1_1events_1_1bundle__announcement__removed.html">core::events::bundle_announcement_removed</a>{ .<a class="code hl_variable" href="structradix__relay_1_1core_1_1events_1_1bundle__announcement__removed.html#a61dffabbf7ec012ab5c6aeb3a7e3d2ca">pubkey</a> = <span class="keyword">event</span>.pubkey, .event_id = <span class="keyword">event</span>.id };</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>    }</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span> </div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>    <span class="keywordflow">return</span> <a class="code hl_struct" href="structradix__relay_1_1core_1_1events_1_1bundle__announcement__received.html">core::events::bundle_announcement_received</a>{</div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>      .<a class="code hl_variable" href="structradix__relay_1_1core_1_1events_1_1bundle__announcement__received.html#aa18f612c00d21c7ea9945c618b98a7f1">pubkey</a> = <span class="keyword">event</span>.pubkey, .bundle_content = <span class="keyword">event</span>.content, .event_id = <span class="keyword">event</span>.id</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>    };</div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>  }</div>
</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span> </div>
<div class="foldopen" id="foldopen00122" data-start="{" data-end="}">
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno"><a class="line" href="classradix__relay_1_1nostr_1_1message__handler.html#a3b8daab54439b3c19c4f633a54b0b27c">  122</a></span>  [[nodiscard]] <span class="keyword">auto</span> <a class="code hl_function" href="classradix__relay_1_1nostr_1_1message__handler.html#a3b8daab54439b3c19c4f633a54b0b27c">handle</a>(<span class="keyword">const</span> <a class="code hl_struct" href="structradix__relay_1_1core_1_1events_1_1send.html">core::events::send</a> &amp;cmd) -&gt; std::pair&lt;std::string, std::vector&lt;std::byte&gt;&gt;</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>  {</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>    std::vector&lt;uint8_t&gt; plaintext_bytes(cmd.message.begin(), cmd.message.end());</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>    <span class="keyword">auto</span> encrypted_bytes = bridge_-&gt;encrypt_message(cmd.peer, plaintext_bytes);</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span> </div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>    std::string hex_content;</div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;<span class="keywordtype">byte</span> : encrypted_bytes) { hex_content += fmt::format(<span class="stringliteral">&quot;{:02x}&quot;</span>, <span class="keywordtype">byte</span>); }</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span> </div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>    <span class="keyword">auto</span> signed_event_json = bridge_-&gt;create_and_sign_encrypted_message(</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>      cmd.peer, hex_content, <span class="keyword">static_cast&lt;</span>std::uint32_t<span class="keyword">&gt;</span>(std::time(<span class="keyword">nullptr</span>)), std::string{ cmake::project_version });</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span> </div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>    <span class="keyword">auto</span> event_json = nlohmann::json::parse(signed_event_json);</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>    <span class="keyword">const</span> std::string event_id = event_json[<span class="stringliteral">&quot;id&quot;</span>].template get&lt;std::string&gt;();</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span> </div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>    <a class="code hl_struct" href="structradix__relay_1_1nostr_1_1protocol_1_1event__data.html">nostr::protocol::event_data</a> event_data;</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>    event_data.<a class="code hl_variable" href="structradix__relay_1_1nostr_1_1protocol_1_1event__data.html#a3fc5773052c6e3d3f64dccdbd2db0b98">id</a> = event_id;</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>    event_data.<a class="code hl_variable" href="structradix__relay_1_1nostr_1_1protocol_1_1event__data.html#ac6a51030983d7a3efcd120e99e1216bc">pubkey</a> = event_json[<span class="stringliteral">&quot;pubkey&quot;</span>].template get&lt;std::string&gt;();</div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>    event_data.<a class="code hl_variable" href="structradix__relay_1_1nostr_1_1protocol_1_1event__data.html#ad2c974dc92da18bd3987fb021c08cdda">created_at</a> = event_json[<span class="stringliteral">&quot;created_at&quot;</span>].template get&lt;std::uint64_t&gt;();</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>    event_data.kind = event_json[<span class="stringliteral">&quot;kind&quot;</span>].template get&lt;nostr::protocol::kind&gt;();</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>    event_data.<a class="code hl_variable" href="structradix__relay_1_1nostr_1_1protocol_1_1event__data.html#ab3877bf983c769f85d3569c6aea5dcc1">content</a> = event_json[<span class="stringliteral">&quot;content&quot;</span>].template get&lt;std::string&gt;();</div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>    event_data.<a class="code hl_variable" href="structradix__relay_1_1nostr_1_1protocol_1_1event__data.html#a3823414427e387f57de53756df87069d">sig</a> = event_json[<span class="stringliteral">&quot;sig&quot;</span>].template get&lt;std::string&gt;();</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span> </div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;tag : event_json[<span class="stringliteral">&quot;tags&quot;</span>]) {</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>      std::vector&lt;std::string&gt; tag_vec;</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>      std::ranges::transform(</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>        tag, std::back_inserter(tag_vec), [](<span class="keyword">const</span> <span class="keyword">auto</span> &amp;item) { <span class="keywordflow">return</span> item.template get&lt;std::string&gt;(); });</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>      event_data.<a class="code hl_variable" href="structradix__relay_1_1nostr_1_1protocol_1_1event__data.html#ad3bdd331d2c40833d6b27bb5a7716fb4">tags</a>.push_back(tag_vec);</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>    }</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span> </div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>    <span class="keyword">auto</span> protocol_event = <a class="code hl_function" href="structradix__relay_1_1nostr_1_1protocol_1_1event.html#ae5eba508f6386bb9ec3aad35e88a6868">nostr::protocol::event::from_event_data</a>(event_data);</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>    <span class="keyword">auto</span> json_str = protocol_event.serialize();</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span> </div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>    std::vector&lt;std::byte&gt; bytes;</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>    bytes.resize(json_str.size());</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>    std::ranges::transform(json_str, bytes.begin(), [](<span class="keywordtype">char</span> character) { return std::bit_cast&lt;std::byte&gt;(character); });</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span> </div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>    <span class="keywordflow">return</span> { event_id, bytes };</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>  }</div>
</div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span> </div>
<div class="foldopen" id="foldopen00167" data-start="{" data-end="}">
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno"><a class="line" href="classradix__relay_1_1nostr_1_1message__handler.html#ab2ec54ce92d609f3b3ae472df4f85697">  167</a></span>  [[nodiscard]] <span class="keyword">auto</span> <a class="code hl_function" href="classradix__relay_1_1nostr_1_1message__handler.html#ab2ec54ce92d609f3b3ae472df4f85697">handle</a>(<span class="keyword">const</span> <a class="code hl_struct" href="structradix__relay_1_1core_1_1events_1_1publish__identity.html">core::events::publish_identity</a> &amp; <span class="comment">/*command*/</span>) -&gt; <a class="code hl_struct" href="structradix__relay_1_1nostr_1_1publish__bundle__result.html">publish_bundle_result</a></div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>  {</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>    <span class="keyword">const</span> std::string version_str{ radix_relay::cmake::project_version };</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>    <span class="keyword">auto</span> bundle_info = bridge_-&gt;generate_prekey_bundle_announcement(version_str);</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>    <span class="keyword">auto</span> event_json = nlohmann::json::parse(bundle_info.announcement_json);</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span> </div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>    <span class="keyword">const</span> std::string event_id = event_json[<span class="stringliteral">&quot;id&quot;</span>].template get&lt;std::string&gt;();</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span> </div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>    <a class="code hl_struct" href="structradix__relay_1_1nostr_1_1protocol_1_1event__data.html">nostr::protocol::event_data</a> event_data;</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>    event_data.<a class="code hl_variable" href="structradix__relay_1_1nostr_1_1protocol_1_1event__data.html#a3fc5773052c6e3d3f64dccdbd2db0b98">id</a> = event_id;</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>    event_data.<a class="code hl_variable" href="structradix__relay_1_1nostr_1_1protocol_1_1event__data.html#ac6a51030983d7a3efcd120e99e1216bc">pubkey</a> = event_json[<span class="stringliteral">&quot;pubkey&quot;</span>].template get&lt;std::string&gt;();</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>    event_data.<a class="code hl_variable" href="structradix__relay_1_1nostr_1_1protocol_1_1event__data.html#ad2c974dc92da18bd3987fb021c08cdda">created_at</a> = event_json[<span class="stringliteral">&quot;created_at&quot;</span>].template get&lt;std::uint64_t&gt;();</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>    event_data.kind = event_json[<span class="stringliteral">&quot;kind&quot;</span>].template get&lt;nostr::protocol::kind&gt;();</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>    event_data.<a class="code hl_variable" href="structradix__relay_1_1nostr_1_1protocol_1_1event__data.html#ab3877bf983c769f85d3569c6aea5dcc1">content</a> = event_json[<span class="stringliteral">&quot;content&quot;</span>].template get&lt;std::string&gt;();</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>    event_data.<a class="code hl_variable" href="structradix__relay_1_1nostr_1_1protocol_1_1event__data.html#a3823414427e387f57de53756df87069d">sig</a> = event_json[<span class="stringliteral">&quot;sig&quot;</span>].template get&lt;std::string&gt;();</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span> </div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;tag : event_json[<span class="stringliteral">&quot;tags&quot;</span>]) {</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>      std::vector&lt;std::string&gt; tag_vec;</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>      std::ranges::transform(</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>        tag, std::back_inserter(tag_vec), [](<span class="keyword">const</span> <span class="keyword">auto</span> &amp;item) { <span class="keywordflow">return</span> item.template get&lt;std::string&gt;(); });</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>      event_data.<a class="code hl_variable" href="structradix__relay_1_1nostr_1_1protocol_1_1event__data.html#ad3bdd331d2c40833d6b27bb5a7716fb4">tags</a>.push_back(tag_vec);</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>    }</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span> </div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>    <span class="keyword">auto</span> protocol_event = <a class="code hl_function" href="structradix__relay_1_1nostr_1_1protocol_1_1event.html#ae5eba508f6386bb9ec3aad35e88a6868">nostr::protocol::event::from_event_data</a>(event_data);</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>    <span class="keyword">auto</span> json_str = protocol_event.serialize();</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span> </div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>    std::vector&lt;std::byte&gt; bytes;</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>    bytes.resize(json_str.size());</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>    std::ranges::transform(json_str, bytes.begin(), [](<span class="keywordtype">char</span> character) { return std::bit_cast&lt;std::byte&gt;(character); });</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span> </div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>    <span class="keywordflow">return</span> <a class="code hl_struct" href="structradix__relay_1_1nostr_1_1publish__bundle__result.html">publish_bundle_result</a>{ .<a class="code hl_variable" href="structradix__relay_1_1nostr_1_1publish__bundle__result.html#a06567c37b9b3f6336a4fb22f47c5f7c1">event_id</a> = event_id,</div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>      .bytes = std::move(bytes),</div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>      .pre_key_id = bundle_info.pre_key_id,</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>      .signed_pre_key_id = bundle_info.signed_pre_key_id,</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>      .kyber_pre_key_id = bundle_info.kyber_pre_key_id };</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>  }</div>
</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span> </div>
<div class="foldopen" id="foldopen00210" data-start="{" data-end="}">
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno"><a class="line" href="classradix__relay_1_1nostr_1_1message__handler.html#a93b3dc602d46a550b2ae14629bfdb316">  210</a></span>  [[nodiscard]] <span class="keyword">auto</span> <a class="code hl_function" href="classradix__relay_1_1nostr_1_1message__handler.html#a93b3dc602d46a550b2ae14629bfdb316">handle</a>(<span class="keyword">const</span> <a class="code hl_struct" href="structradix__relay_1_1core_1_1events_1_1unpublish__identity.html">core::events::unpublish_identity</a> &amp; <span class="comment">/*command*/</span>)</div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>    -&gt; std::pair&lt;std::string, std::vector&lt;std::byte&gt;&gt;</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>  {</div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>    <span class="keyword">const</span> std::string version_str{ radix_relay::cmake::project_version };</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>    <span class="keyword">auto</span> bundle_json = bridge_-&gt;generate_empty_bundle_announcement(version_str);</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>    <span class="keyword">auto</span> event_json = nlohmann::json::parse(bundle_json);</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span> </div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>    <span class="keyword">const</span> std::string event_id = event_json[<span class="stringliteral">&quot;id&quot;</span>].template get&lt;std::string&gt;();</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span> </div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>    <a class="code hl_struct" href="structradix__relay_1_1nostr_1_1protocol_1_1event__data.html">nostr::protocol::event_data</a> event_data;</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>    event_data.<a class="code hl_variable" href="structradix__relay_1_1nostr_1_1protocol_1_1event__data.html#a3fc5773052c6e3d3f64dccdbd2db0b98">id</a> = event_id;</div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>    event_data.<a class="code hl_variable" href="structradix__relay_1_1nostr_1_1protocol_1_1event__data.html#ac6a51030983d7a3efcd120e99e1216bc">pubkey</a> = event_json[<span class="stringliteral">&quot;pubkey&quot;</span>].template get&lt;std::string&gt;();</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>    event_data.<a class="code hl_variable" href="structradix__relay_1_1nostr_1_1protocol_1_1event__data.html#ad2c974dc92da18bd3987fb021c08cdda">created_at</a> = event_json[<span class="stringliteral">&quot;created_at&quot;</span>].template get&lt;std::uint64_t&gt;();</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>    event_data.kind = event_json[<span class="stringliteral">&quot;kind&quot;</span>].template get&lt;nostr::protocol::kind&gt;();</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>    event_data.<a class="code hl_variable" href="structradix__relay_1_1nostr_1_1protocol_1_1event__data.html#ab3877bf983c769f85d3569c6aea5dcc1">content</a> = event_json[<span class="stringliteral">&quot;content&quot;</span>].template get&lt;std::string&gt;();</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>    event_data.<a class="code hl_variable" href="structradix__relay_1_1nostr_1_1protocol_1_1event__data.html#a3823414427e387f57de53756df87069d">sig</a> = event_json[<span class="stringliteral">&quot;sig&quot;</span>].template get&lt;std::string&gt;();</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span> </div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;tag : event_json[<span class="stringliteral">&quot;tags&quot;</span>]) {</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>      std::vector&lt;std::string&gt; tag_vec;</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>      std::ranges::transform(</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>        tag, std::back_inserter(tag_vec), [](<span class="keyword">const</span> <span class="keyword">auto</span> &amp;item) { <span class="keywordflow">return</span> item.template get&lt;std::string&gt;(); });</div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>      event_data.<a class="code hl_variable" href="structradix__relay_1_1nostr_1_1protocol_1_1event__data.html#ad3bdd331d2c40833d6b27bb5a7716fb4">tags</a>.push_back(tag_vec);</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>    }</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span> </div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>    <span class="keyword">auto</span> protocol_event = <a class="code hl_function" href="structradix__relay_1_1nostr_1_1protocol_1_1event.html#ae5eba508f6386bb9ec3aad35e88a6868">nostr::protocol::event::from_event_data</a>(event_data);</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>    <span class="keyword">auto</span> json_str = protocol_event.serialize();</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span> </div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>    std::vector&lt;std::byte&gt; bytes;</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>    bytes.resize(json_str.size());</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>    std::ranges::transform(json_str, bytes.begin(), [](<span class="keywordtype">char</span> character) { return std::bit_cast&lt;std::byte&gt;(character); });</div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span> </div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>    <span class="keywordflow">return</span> { event_id, bytes };</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>  }</div>
</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span> </div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno"><a class="line" href="classradix__relay_1_1nostr_1_1message__handler.html#a40d2c0b5b2d3bf1d62318f43d9c76389">  249</a></span>  <span class="keyword">auto</span> <a class="code hl_function" href="classradix__relay_1_1nostr_1_1message__handler.html#a40d2c0b5b2d3bf1d62318f43d9c76389">handle</a>(<span class="keyword">const</span> <a class="code hl_struct" href="structradix__relay_1_1core_1_1events_1_1trust.html">core::events::trust</a> &amp;cmd) -&gt; <span class="keywordtype">void</span> { bridge_-&gt;assign_contact_alias(cmd.peer, cmd.alias); }</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span> </div>
<div class="foldopen" id="foldopen00257" data-start="{" data-end="}">
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno"><a class="line" href="classradix__relay_1_1nostr_1_1message__handler.html#af9e94d10a0b9b498c89f7ca335de706a">  257</a></span>  [[nodiscard]] <span class="keyword">auto</span> <a class="code hl_function" href="classradix__relay_1_1nostr_1_1message__handler.html#af9e94d10a0b9b498c89f7ca335de706a">handle</a>(<span class="keyword">const</span> <a class="code hl_struct" href="structradix__relay_1_1core_1_1events_1_1establish__session.html">core::events::establish_session</a> &amp;cmd)</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>    -&gt; std::optional&lt;core::events::session_established&gt;</div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>  {</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>    <span class="keyword">auto</span> peer_rdx = bridge_-&gt;add_contact_and_establish_session_from_base64(cmd.bundle_data, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>    <span class="keywordflow">return</span> <a class="code hl_struct" href="structradix__relay_1_1core_1_1events_1_1session__established.html">core::events::session_established</a>{ peer_rdx };</div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>  }</div>
</div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span> </div>
<div class="foldopen" id="foldopen00270" data-start="{" data-end="}">
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno"><a class="line" href="classradix__relay_1_1nostr_1_1message__handler.html#a461d0d92bf66effb022a9d6e9ddf61c7">  270</a></span>  [[nodiscard]] <span class="keyword">static</span> <span class="keyword">auto</span> <a class="code hl_function" href="classradix__relay_1_1nostr_1_1message__handler.html#a461d0d92bf66effb022a9d6e9ddf61c7">handle</a>(<span class="keyword">const</span> <a class="code hl_struct" href="structradix__relay_1_1core_1_1events_1_1subscribe.html">core::events::subscribe</a> &amp;cmd) -&gt; std::pair&lt;std::string, std::vector&lt;std::byte&gt;&gt;</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>  {</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>    std::vector&lt;std::byte&gt; bytes;</div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>    bytes.resize(cmd.subscription_json.size());</div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>    std::ranges::transform(</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>      cmd.subscription_json, bytes.begin(), [](<span class="keywordtype">char</span> character) { return std::bit_cast&lt;std::byte&gt;(character); });</div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span> </div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>    <span class="keyword">auto</span> parsed = nlohmann::json::parse(cmd.subscription_json);</div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>    <span class="keyword">const</span> std::string subscription_id = parsed[1].get&lt;std::string&gt;();</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span> </div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>    <span class="keywordflow">return</span> { subscription_id, bytes };</div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>  }</div>
</div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span> </div>
<div class="foldopen" id="foldopen00288" data-start="{" data-end="}">
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno"><a class="line" href="classradix__relay_1_1nostr_1_1message__handler.html#aafdb72cb431ef18997422f292bd82115">  288</a></span>  <span class="keyword">static</span> <span class="keyword">auto</span> <a class="code hl_function" href="classradix__relay_1_1nostr_1_1message__handler.html#aafdb72cb431ef18997422f292bd82115">handle</a>(<span class="keyword">const</span> <a class="code hl_struct" href="structradix__relay_1_1nostr_1_1events_1_1incoming_1_1ok.html">nostr::events::incoming::ok</a> &amp;event) -&gt; <span class="keywordtype">void</span></div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>  {</div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>    spdlog::debug(<span class="stringliteral">&quot;[nostr_handler] OK received: event_id={}, accepted={}, message={}&quot;</span>,</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>      event.event_id,</div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>      event.accepted,</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>      event.message);</div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span>  }</div>
</div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span> </div>
<div class="foldopen" id="foldopen00301" data-start="{" data-end="}">
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno"><a class="line" href="classradix__relay_1_1nostr_1_1message__handler.html#ad358bc6025cbfdc65f639e4cdfaa4dfa">  301</a></span>  <span class="keyword">static</span> <span class="keyword">auto</span> <a class="code hl_function" href="classradix__relay_1_1nostr_1_1message__handler.html#ad358bc6025cbfdc65f639e4cdfaa4dfa">handle</a>(<span class="keyword">const</span> <a class="code hl_struct" href="structradix__relay_1_1nostr_1_1events_1_1incoming_1_1eose.html">nostr::events::incoming::eose</a> &amp;event) -&gt; <span class="keywordtype">void</span></div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>  {</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>    spdlog::debug(<span class="stringliteral">&quot;[nostr_handler] EOSE received: subscription_id={}&quot;</span>, event.subscription_id);</div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>  }</div>
</div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span> </div>
<div class="foldopen" id="foldopen00311" data-start="{" data-end="}">
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno"><a class="line" href="classradix__relay_1_1nostr_1_1message__handler.html#a5e40fc3d19325be6afd6d3964af2127b">  311</a></span>  <span class="keyword">static</span> <span class="keyword">auto</span> <a class="code hl_function" href="classradix__relay_1_1nostr_1_1message__handler.html#a5e40fc3d19325be6afd6d3964af2127b">handle</a>(<span class="keyword">const</span> <a class="code hl_struct" href="structradix__relay_1_1nostr_1_1events_1_1incoming_1_1unknown__message.html">nostr::events::incoming::unknown_message</a> &amp;event) -&gt; <span class="keywordtype">void</span></div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>  {</div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>    spdlog::warn(<span class="stringliteral">&quot;[nostr_handler] Unknown message kind: {}&quot;</span>, <span class="keyword">static_cast&lt;</span>std::uint16_t<span class="keyword">&gt;</span>(event.kind));</div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span>  }</div>
</div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span> </div>
<div class="foldopen" id="foldopen00321" data-start="{" data-end="}">
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno"><a class="line" href="classradix__relay_1_1nostr_1_1message__handler.html#a833ec001788d1c3a8018bf66b2be6e61">  321</a></span>  <span class="keyword">static</span> <span class="keyword">auto</span> <a class="code hl_function" href="classradix__relay_1_1nostr_1_1message__handler.html#a833ec001788d1c3a8018bf66b2be6e61">handle</a>(<span class="keyword">const</span> <a class="code hl_struct" href="structradix__relay_1_1nostr_1_1events_1_1incoming_1_1unknown__protocol.html">nostr::events::incoming::unknown_protocol</a> &amp;event) -&gt; <span class="keywordtype">void</span></div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>  {</div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>    spdlog::warn(<span class="stringliteral">&quot;[nostr_handler] Unknown protocol message: {}&quot;</span>, event.message);</div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span>  }</div>
</div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span> </div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno"><a class="line" href="classradix__relay_1_1nostr_1_1message__handler.html#a207c56d97b843421c257dd2d70a0025a">  331</a></span>  <span class="keyword">static</span> <span class="keyword">auto</span> <a class="code hl_function" href="classradix__relay_1_1nostr_1_1message__handler.html#a207c56d97b843421c257dd2d70a0025a">handle</a>(<span class="keyword">const</span> <a class="code hl_struct" href="structradix__relay_1_1nostr_1_1events_1_1incoming_1_1identity__announcement.html">nostr::events::incoming::identity_announcement</a> &amp; <span class="comment">/*event*/</span>) -&gt; <span class="keywordtype">void</span> {}</div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span> </div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno"><a class="line" href="classradix__relay_1_1nostr_1_1message__handler.html#a7b78c1e954367f85bbfa6ffdbd9a9ca3">  338</a></span>  <span class="keyword">static</span> <span class="keyword">auto</span> <a class="code hl_function" href="classradix__relay_1_1nostr_1_1message__handler.html#a7b78c1e954367f85bbfa6ffdbd9a9ca3">handle</a>(<span class="keyword">const</span> <a class="code hl_struct" href="structradix__relay_1_1nostr_1_1events_1_1incoming_1_1session__request.html">nostr::events::incoming::session_request</a> &amp; <span class="comment">/*event*/</span>) -&gt; <span class="keywordtype">void</span> {}</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span> </div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno"><a class="line" href="classradix__relay_1_1nostr_1_1message__handler.html#ac9b493549aa9728029d254647b904771">  345</a></span>  <span class="keyword">static</span> <span class="keyword">auto</span> <a class="code hl_function" href="classradix__relay_1_1nostr_1_1message__handler.html#ac9b493549aa9728029d254647b904771">handle</a>(<span class="keyword">const</span> <a class="code hl_struct" href="structradix__relay_1_1nostr_1_1events_1_1incoming_1_1node__status.html">nostr::events::incoming::node_status</a> &amp; <span class="comment">/*event*/</span>) -&gt; <span class="keywordtype">void</span> {}</div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span> </div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span><span class="keyword">private</span>:</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>  std::shared_ptr&lt;Bridge&gt; bridge_;</div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>};</div>
</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span> </div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>}<span class="comment">// namespace radix_relay::nostr</span></div>
<div class="ttc" id="aclassradix__relay_1_1nostr_1_1message__handler_html"><div class="ttname"><a href="classradix__relay_1_1nostr_1_1message__handler.html">radix_relay::nostr::message_handler</a></div><div class="ttdoc">Handles processing of incoming and outgoing Nostr messages.</div><div class="ttdef"><b>Definition</b> <a href="message__handler_8hpp_source.html#l00044">message_handler.hpp:45</a></div></div>
<div class="ttc" id="aclassradix__relay_1_1nostr_1_1message__handler_html_a207c56d97b843421c257dd2d70a0025a"><div class="ttname"><a href="classradix__relay_1_1nostr_1_1message__handler.html#a207c56d97b843421c257dd2d70a0025a">radix_relay::nostr::message_handler::handle</a></div><div class="ttdeci">static auto handle(const nostr::events::incoming::identity_announcement &amp;) -&gt; void</div><div class="ttdoc">Handles an incoming identity announcement (no-op).</div><div class="ttdef"><b>Definition</b> <a href="message__handler_8hpp_source.html#l00331">message_handler.hpp:331</a></div></div>
<div class="ttc" id="aclassradix__relay_1_1nostr_1_1message__handler_html_a3b8daab54439b3c19c4f633a54b0b27c"><div class="ttname"><a href="classradix__relay_1_1nostr_1_1message__handler.html#a3b8daab54439b3c19c4f633a54b0b27c">radix_relay::nostr::message_handler::handle</a></div><div class="ttdeci">auto handle(const core::events::send &amp;cmd) -&gt; std::pair&lt; std::string, std::vector&lt; std::byte &gt; &gt;</div><div class="ttdoc">Handles a send command by encrypting and serializing a message.</div><div class="ttdef"><b>Definition</b> <a href="message__handler_8hpp_source.html#l00122">message_handler.hpp:122</a></div></div>
<div class="ttc" id="aclassradix__relay_1_1nostr_1_1message__handler_html_a40d2c0b5b2d3bf1d62318f43d9c76389"><div class="ttname"><a href="classradix__relay_1_1nostr_1_1message__handler.html#a40d2c0b5b2d3bf1d62318f43d9c76389">radix_relay::nostr::message_handler::handle</a></div><div class="ttdeci">auto handle(const core::events::trust &amp;cmd) -&gt; void</div><div class="ttdoc">Handles a trust command by assigning an alias to a peer.</div><div class="ttdef"><b>Definition</b> <a href="message__handler_8hpp_source.html#l00249">message_handler.hpp:249</a></div></div>
<div class="ttc" id="aclassradix__relay_1_1nostr_1_1message__handler_html_a461d0d92bf66effb022a9d6e9ddf61c7"><div class="ttname"><a href="classradix__relay_1_1nostr_1_1message__handler.html#a461d0d92bf66effb022a9d6e9ddf61c7">radix_relay::nostr::message_handler::handle</a></div><div class="ttdeci">static auto handle(const core::events::subscribe &amp;cmd) -&gt; std::pair&lt; std::string, std::vector&lt; std::byte &gt; &gt;</div><div class="ttdoc">Handles a subscription request.</div><div class="ttdef"><b>Definition</b> <a href="message__handler_8hpp_source.html#l00270">message_handler.hpp:270</a></div></div>
<div class="ttc" id="aclassradix__relay_1_1nostr_1_1message__handler_html_a5b082f2c844f0adf08e0182e2a3ba163"><div class="ttname"><a href="classradix__relay_1_1nostr_1_1message__handler.html#a5b082f2c844f0adf08e0182e2a3ba163">radix_relay::nostr::message_handler::message_handler</a></div><div class="ttdeci">message_handler(std::shared_ptr&lt; Bridge &gt; bridge)</div><div class="ttdoc">Constructs a message handler.</div><div class="ttdef"><b>Definition</b> <a href="message__handler_8hpp_source.html#l00052">message_handler.hpp:52</a></div></div>
<div class="ttc" id="aclassradix__relay_1_1nostr_1_1message__handler_html_a5d81a483421e8c8bcc9c5a18591251dd"><div class="ttname"><a href="classradix__relay_1_1nostr_1_1message__handler.html#a5d81a483421e8c8bcc9c5a18591251dd">radix_relay::nostr::message_handler::handle</a></div><div class="ttdeci">auto handle(const nostr::events::incoming::encrypted_message &amp;event) -&gt; std::optional&lt; core::events::message_received &gt;</div><div class="ttdoc">Handles an incoming encrypted message event.</div><div class="ttdef"><b>Definition</b> <a href="message__handler_8hpp_source.html#l00060">message_handler.hpp:60</a></div></div>
<div class="ttc" id="aclassradix__relay_1_1nostr_1_1message__handler_html_a5e40fc3d19325be6afd6d3964af2127b"><div class="ttname"><a href="classradix__relay_1_1nostr_1_1message__handler.html#a5e40fc3d19325be6afd6d3964af2127b">radix_relay::nostr::message_handler::handle</a></div><div class="ttdeci">static auto handle(const nostr::events::incoming::unknown_message &amp;event) -&gt; void</div><div class="ttdoc">Handles an unknown message type (logs warning).</div><div class="ttdef"><b>Definition</b> <a href="message__handler_8hpp_source.html#l00311">message_handler.hpp:311</a></div></div>
<div class="ttc" id="aclassradix__relay_1_1nostr_1_1message__handler_html_a7b78c1e954367f85bbfa6ffdbd9a9ca3"><div class="ttname"><a href="classradix__relay_1_1nostr_1_1message__handler.html#a7b78c1e954367f85bbfa6ffdbd9a9ca3">radix_relay::nostr::message_handler::handle</a></div><div class="ttdeci">static auto handle(const nostr::events::incoming::session_request &amp;) -&gt; void</div><div class="ttdoc">Handles an incoming session request (no-op).</div><div class="ttdef"><b>Definition</b> <a href="message__handler_8hpp_source.html#l00338">message_handler.hpp:338</a></div></div>
<div class="ttc" id="aclassradix__relay_1_1nostr_1_1message__handler_html_a833ec001788d1c3a8018bf66b2be6e61"><div class="ttname"><a href="classradix__relay_1_1nostr_1_1message__handler.html#a833ec001788d1c3a8018bf66b2be6e61">radix_relay::nostr::message_handler::handle</a></div><div class="ttdeci">static auto handle(const nostr::events::incoming::unknown_protocol &amp;event) -&gt; void</div><div class="ttdoc">Handles an unknown protocol message (logs warning).</div><div class="ttdef"><b>Definition</b> <a href="message__handler_8hpp_source.html#l00321">message_handler.hpp:321</a></div></div>
<div class="ttc" id="aclassradix__relay_1_1nostr_1_1message__handler_html_a93b3dc602d46a550b2ae14629bfdb316"><div class="ttname"><a href="classradix__relay_1_1nostr_1_1message__handler.html#a93b3dc602d46a550b2ae14629bfdb316">radix_relay::nostr::message_handler::handle</a></div><div class="ttdeci">auto handle(const core::events::unpublish_identity &amp;) -&gt; std::pair&lt; std::string, std::vector&lt; std::byte &gt; &gt;</div><div class="ttdoc">Handles an unpublish identity command by generating an empty bundle.</div><div class="ttdef"><b>Definition</b> <a href="message__handler_8hpp_source.html#l00210">message_handler.hpp:210</a></div></div>
<div class="ttc" id="aclassradix__relay_1_1nostr_1_1message__handler_html_a9e24647bad00caee8f44e26472327d59"><div class="ttname"><a href="classradix__relay_1_1nostr_1_1message__handler.html#a9e24647bad00caee8f44e26472327d59">radix_relay::nostr::message_handler::handle</a></div><div class="ttdeci">static auto handle(const nostr::events::incoming::bundle_announcement &amp;event) -&gt; std::optional&lt; std::variant&lt; core::events::bundle_announcement_received, core::events::bundle_announcement_removed &gt; &gt;</div><div class="ttdoc">Handles an incoming bundle announcement event.</div><div class="ttdef"><b>Definition</b> <a href="message__handler_8hpp_source.html#l00097">message_handler.hpp:97</a></div></div>
<div class="ttc" id="aclassradix__relay_1_1nostr_1_1message__handler_html_aafdb72cb431ef18997422f292bd82115"><div class="ttname"><a href="classradix__relay_1_1nostr_1_1message__handler.html#aafdb72cb431ef18997422f292bd82115">radix_relay::nostr::message_handler::handle</a></div><div class="ttdeci">static auto handle(const nostr::events::incoming::ok &amp;event) -&gt; void</div><div class="ttdoc">Handles an incoming OK response (logs only).</div><div class="ttdef"><b>Definition</b> <a href="message__handler_8hpp_source.html#l00288">message_handler.hpp:288</a></div></div>
<div class="ttc" id="aclassradix__relay_1_1nostr_1_1message__handler_html_ab2ec54ce92d609f3b3ae472df4f85697"><div class="ttname"><a href="classradix__relay_1_1nostr_1_1message__handler.html#ab2ec54ce92d609f3b3ae472df4f85697">radix_relay::nostr::message_handler::handle</a></div><div class="ttdeci">auto handle(const core::events::publish_identity &amp;) -&gt; publish_bundle_result</div><div class="ttdoc">Handles a publish identity command by generating and serializing a bundle.</div><div class="ttdef"><b>Definition</b> <a href="message__handler_8hpp_source.html#l00167">message_handler.hpp:167</a></div></div>
<div class="ttc" id="aclassradix__relay_1_1nostr_1_1message__handler_html_ac9b493549aa9728029d254647b904771"><div class="ttname"><a href="classradix__relay_1_1nostr_1_1message__handler.html#ac9b493549aa9728029d254647b904771">radix_relay::nostr::message_handler::handle</a></div><div class="ttdeci">static auto handle(const nostr::events::incoming::node_status &amp;) -&gt; void</div><div class="ttdoc">Handles an incoming node status update (no-op).</div><div class="ttdef"><b>Definition</b> <a href="message__handler_8hpp_source.html#l00345">message_handler.hpp:345</a></div></div>
<div class="ttc" id="aclassradix__relay_1_1nostr_1_1message__handler_html_ad358bc6025cbfdc65f639e4cdfaa4dfa"><div class="ttname"><a href="classradix__relay_1_1nostr_1_1message__handler.html#ad358bc6025cbfdc65f639e4cdfaa4dfa">radix_relay::nostr::message_handler::handle</a></div><div class="ttdeci">static auto handle(const nostr::events::incoming::eose &amp;event) -&gt; void</div><div class="ttdoc">Handles an incoming EOSE marker (logs only).</div><div class="ttdef"><b>Definition</b> <a href="message__handler_8hpp_source.html#l00301">message_handler.hpp:301</a></div></div>
<div class="ttc" id="aclassradix__relay_1_1nostr_1_1message__handler_html_af9e94d10a0b9b498c89f7ca335de706a"><div class="ttname"><a href="classradix__relay_1_1nostr_1_1message__handler.html#af9e94d10a0b9b498c89f7ca335de706a">radix_relay::nostr::message_handler::handle</a></div><div class="ttdeci">auto handle(const core::events::establish_session &amp;cmd) -&gt; std::optional&lt; core::events::session_established &gt;</div><div class="ttdoc">Handles session establishment from bundle data.</div><div class="ttdef"><b>Definition</b> <a href="message__handler_8hpp_source.html#l00257">message_handler.hpp:257</a></div></div>
<div class="ttc" id="acore_2include_2concepts_2signal__bridge_8hpp_html"><div class="ttname"><a href="core_2include_2concepts_2signal__bridge_8hpp.html">signal_bridge.hpp</a></div></div>
<div class="ttc" id="acore_2include_2core_2events_8hpp_html"><div class="ttname"><a href="core_2include_2core_2events_8hpp.html">events.hpp</a></div></div>
<div class="ttc" id="acore_2include_2core_2semver__utils_8hpp_html"><div class="ttname"><a href="core_2include_2core_2semver__utils_8hpp.html">semver_utils.hpp</a></div></div>
<div class="ttc" id="anamespaceradix__relay_1_1core_html_a878296935424282b4081eebd803dc192"><div class="ttname"><a href="namespaceradix__relay_1_1core.html#a878296935424282b4081eebd803dc192">radix_relay::core::is_version_compatible</a></div><div class="ttdeci">auto is_version_compatible(const std::string &amp;version_str, const std::string &amp;minimum_version_str) -&gt; bool</div><div class="ttdoc">Checks if a version meets a minimum version requirement.</div><div class="ttdef"><b>Definition</b> <a href="core_2include_2core_2semver__utils_8hpp_source.html#l00015">semver_utils.hpp:15</a></div></div>
<div class="ttc" id="anamespaceradix__relay_1_1nostr_1_1protocol_html_a07dd2beffb69fcfff52b2d087e36b972"><div class="ttname"><a href="namespaceradix__relay_1_1nostr_1_1protocol.html#a07dd2beffb69fcfff52b2d087e36b972">radix_relay::nostr::protocol::bundle_announcement_minimum_version</a></div><div class="ttdeci">constexpr auto bundle_announcement_minimum_version</div><div class="ttdoc">Minimum protocol version required for bundle announcements.</div><div class="ttdef"><b>Definition</b> <a href="protocol_8hpp_source.html#l00014">protocol.hpp:14</a></div></div>
<div class="ttc" id="anamespaceradix__relay_1_1nostr_html"><div class="ttname"><a href="namespaceradix__relay_1_1nostr.html">radix_relay::nostr</a></div><div class="ttdef"><b>Definition</b> <a href="nostr_2include_2nostr_2events_8hpp_source.html#l00005">events.hpp:5</a></div></div>
<div class="ttc" id="anamespaceradix__relay_1_1nostr_html_afc61f07b63e28b68f812eaeee1f2e5a6"><div class="ttname"><a href="namespaceradix__relay_1_1nostr.html#afc61f07b63e28b68f812eaeee1f2e5a6">radix_relay::nostr::extract_version_from_tags</a></div><div class="ttdeci">auto extract_version_from_tags(const std::vector&lt; std::vector&lt; std::string &gt; &gt; &amp;tags) -&gt; std::optional&lt; std::string &gt;</div><div class="ttdoc">Extracts Radix protocol version from Nostr event tags.</div><div class="ttdef"><b>Definition</b> <a href="nostr_2include_2nostr_2semver__utils_8hpp_source.html#l00016">semver_utils.hpp:16</a></div></div>
<div class="ttc" id="anostr_2include_2nostr_2events_8hpp_html"><div class="ttname"><a href="nostr_2include_2nostr_2events_8hpp.html">events.hpp</a></div></div>
<div class="ttc" id="anostr_2include_2nostr_2semver__utils_8hpp_html"><div class="ttname"><a href="nostr_2include_2nostr_2semver__utils_8hpp.html">semver_utils.hpp</a></div></div>
<div class="ttc" id="aprotocol_8hpp_html"><div class="ttname"><a href="protocol_8hpp.html">protocol.hpp</a></div></div>
<div class="ttc" id="astructradix__relay_1_1core_1_1events_1_1bundle__announcement__received_html"><div class="ttname"><a href="structradix__relay_1_1core_1_1events_1_1bundle__announcement__received.html">radix_relay::core::events::bundle_announcement_received</a></div><div class="ttdoc">Notification of received bundle announcement.</div><div class="ttdef"><b>Definition</b> <a href="core_2include_2core_2events_8hpp_source.html#l00163">events.hpp:164</a></div></div>
<div class="ttc" id="astructradix__relay_1_1core_1_1events_1_1bundle__announcement__received_html_aa18f612c00d21c7ea9945c618b98a7f1"><div class="ttname"><a href="structradix__relay_1_1core_1_1events_1_1bundle__announcement__received.html#aa18f612c00d21c7ea9945c618b98a7f1">radix_relay::core::events::bundle_announcement_received::pubkey</a></div><div class="ttdeci">std::string pubkey</div><div class="ttdoc">Nostr public key.</div><div class="ttdef"><b>Definition</b> <a href="core_2include_2core_2events_8hpp_source.html#l00165">events.hpp:165</a></div></div>
<div class="ttc" id="astructradix__relay_1_1core_1_1events_1_1bundle__announcement__removed_html"><div class="ttname"><a href="structradix__relay_1_1core_1_1events_1_1bundle__announcement__removed.html">radix_relay::core::events::bundle_announcement_removed</a></div><div class="ttdoc">Notification of removed bundle announcement.</div><div class="ttdef"><b>Definition</b> <a href="core_2include_2core_2events_8hpp_source.html#l00171">events.hpp:172</a></div></div>
<div class="ttc" id="astructradix__relay_1_1core_1_1events_1_1bundle__announcement__removed_html_a61dffabbf7ec012ab5c6aeb3a7e3d2ca"><div class="ttname"><a href="structradix__relay_1_1core_1_1events_1_1bundle__announcement__removed.html#a61dffabbf7ec012ab5c6aeb3a7e3d2ca">radix_relay::core::events::bundle_announcement_removed::pubkey</a></div><div class="ttdeci">std::string pubkey</div><div class="ttdoc">Nostr public key.</div><div class="ttdef"><b>Definition</b> <a href="core_2include_2core_2events_8hpp_source.html#l00173">events.hpp:173</a></div></div>
<div class="ttc" id="astructradix__relay_1_1core_1_1events_1_1establish__session_html"><div class="ttname"><a href="structradix__relay_1_1core_1_1events_1_1establish__session.html">radix_relay::core::events::establish_session</a></div><div class="ttdoc">Establish session from a received bundle.</div><div class="ttdef"><b>Definition</b> <a href="core_2include_2core_2events_8hpp_source.html#l00135">events.hpp:136</a></div></div>
<div class="ttc" id="astructradix__relay_1_1core_1_1events_1_1message__received_html"><div class="ttname"><a href="structradix__relay_1_1core_1_1events_1_1message__received.html">radix_relay::core::events::message_received</a></div><div class="ttdoc">Notification of received encrypted message.</div><div class="ttdef"><b>Definition</b> <a href="core_2include_2core_2events_8hpp_source.html#l00147">events.hpp:148</a></div></div>
<div class="ttc" id="astructradix__relay_1_1core_1_1events_1_1message__received_html_ab0a91e4cf64de1ba529c79883b47c9d6"><div class="ttname"><a href="structradix__relay_1_1core_1_1events_1_1message__received.html#ab0a91e4cf64de1ba529c79883b47c9d6">radix_relay::core::events::message_received::sender_rdx</a></div><div class="ttdeci">std::string sender_rdx</div><div class="ttdoc">RDX fingerprint of sender.</div><div class="ttdef"><b>Definition</b> <a href="core_2include_2core_2events_8hpp_source.html#l00149">events.hpp:149</a></div></div>
<div class="ttc" id="astructradix__relay_1_1core_1_1events_1_1publish__identity_html"><div class="ttname"><a href="structradix__relay_1_1core_1_1events_1_1publish__identity.html">radix_relay::core::events::publish_identity</a></div><div class="ttdoc">Publish identity bundle to the network.</div><div class="ttdef"><b>Definition</b> <a href="core_2include_2core_2events_8hpp_source.html#l00079">events.hpp:80</a></div></div>
<div class="ttc" id="astructradix__relay_1_1core_1_1events_1_1send_html"><div class="ttname"><a href="structradix__relay_1_1core_1_1events_1_1send.html">radix_relay::core::events::send</a></div><div class="ttdoc">Send encrypted message to a specific peer.</div><div class="ttdef"><b>Definition</b> <a href="core_2include_2core_2events_8hpp_source.html#l00055">events.hpp:56</a></div></div>
<div class="ttc" id="astructradix__relay_1_1core_1_1events_1_1session__established_html"><div class="ttname"><a href="structradix__relay_1_1core_1_1events_1_1session__established.html">radix_relay::core::events::session_established</a></div><div class="ttdoc">Notification of successfully established session.</div><div class="ttdef"><b>Definition</b> <a href="core_2include_2core_2events_8hpp_source.html#l00157">events.hpp:158</a></div></div>
<div class="ttc" id="astructradix__relay_1_1core_1_1events_1_1subscribe_html"><div class="ttname"><a href="structradix__relay_1_1core_1_1events_1_1subscribe.html">radix_relay::core::events::subscribe</a></div><div class="ttdoc">Subscribe to custom Nostr events.</div><div class="ttdef"><b>Definition</b> <a href="core_2include_2core_2events_8hpp_source.html#l00119">events.hpp:120</a></div></div>
<div class="ttc" id="astructradix__relay_1_1core_1_1events_1_1trust_html"><div class="ttname"><a href="structradix__relay_1_1core_1_1events_1_1trust.html">radix_relay::core::events::trust</a></div><div class="ttdoc">Establish trust with a peer and assign an alias.</div><div class="ttdef"><b>Definition</b> <a href="core_2include_2core_2events_8hpp_source.html#l00089">events.hpp:90</a></div></div>
<div class="ttc" id="astructradix__relay_1_1core_1_1events_1_1unpublish__identity_html"><div class="ttname"><a href="structradix__relay_1_1core_1_1events_1_1unpublish__identity.html">radix_relay::core::events::unpublish_identity</a></div><div class="ttdoc">Remove identity bundle from the network.</div><div class="ttdef"><b>Definition</b> <a href="core_2include_2core_2events_8hpp_source.html#l00084">events.hpp:85</a></div></div>
<div class="ttc" id="astructradix__relay_1_1nostr_1_1events_1_1incoming_1_1bundle__announcement_html"><div class="ttname"><a href="structradix__relay_1_1nostr_1_1events_1_1incoming_1_1bundle__announcement.html">radix_relay::nostr::events::incoming::bundle_announcement</a></div><div class="ttdoc">Received bundle announcement event.</div><div class="ttdef"><b>Definition</b> <a href="nostr_2include_2nostr_2events_8hpp_source.html#l00011">events.hpp:12</a></div></div>
<div class="ttc" id="astructradix__relay_1_1nostr_1_1events_1_1incoming_1_1encrypted__message_html"><div class="ttname"><a href="structradix__relay_1_1nostr_1_1events_1_1incoming_1_1encrypted__message.html">radix_relay::nostr::events::incoming::encrypted_message</a></div><div class="ttdoc">Received encrypted message event (kind 40001)</div><div class="ttdef"><b>Definition</b> <a href="nostr_2include_2nostr_2events_8hpp_source.html#l00023">events.hpp:24</a></div></div>
<div class="ttc" id="astructradix__relay_1_1nostr_1_1events_1_1incoming_1_1eose_html"><div class="ttname"><a href="structradix__relay_1_1nostr_1_1events_1_1incoming_1_1eose.html">radix_relay::nostr::events::incoming::eose</a></div><div class="ttdoc">Received End of Stored Events marker.</div><div class="ttdef"><b>Definition</b> <a href="nostr_2include_2nostr_2events_8hpp_source.html#l00053">events.hpp:54</a></div></div>
<div class="ttc" id="astructradix__relay_1_1nostr_1_1events_1_1incoming_1_1identity__announcement_html"><div class="ttname"><a href="structradix__relay_1_1nostr_1_1events_1_1incoming_1_1identity__announcement.html">radix_relay::nostr::events::incoming::identity_announcement</a></div><div class="ttdoc">Received identity announcement event.</div><div class="ttdef"><b>Definition</b> <a href="nostr_2include_2nostr_2events_8hpp_source.html#l00017">events.hpp:18</a></div></div>
<div class="ttc" id="astructradix__relay_1_1nostr_1_1events_1_1incoming_1_1node__status_html"><div class="ttname"><a href="structradix__relay_1_1nostr_1_1events_1_1incoming_1_1node__status.html">radix_relay::nostr::events::incoming::node_status</a></div><div class="ttdoc">Received node status announcement.</div><div class="ttdef"><b>Definition</b> <a href="nostr_2include_2nostr_2events_8hpp_source.html#l00035">events.hpp:36</a></div></div>
<div class="ttc" id="astructradix__relay_1_1nostr_1_1events_1_1incoming_1_1ok_html"><div class="ttname"><a href="structradix__relay_1_1nostr_1_1events_1_1incoming_1_1ok.html">radix_relay::nostr::events::incoming::ok</a></div><div class="ttdoc">Received OK response from relay.</div><div class="ttdef"><b>Definition</b> <a href="nostr_2include_2nostr_2events_8hpp_source.html#l00047">events.hpp:48</a></div></div>
<div class="ttc" id="astructradix__relay_1_1nostr_1_1events_1_1incoming_1_1session__request_html"><div class="ttname"><a href="structradix__relay_1_1nostr_1_1events_1_1incoming_1_1session__request.html">radix_relay::nostr::events::incoming::session_request</a></div><div class="ttdoc">Received session establishment request.</div><div class="ttdef"><b>Definition</b> <a href="nostr_2include_2nostr_2events_8hpp_source.html#l00029">events.hpp:30</a></div></div>
<div class="ttc" id="astructradix__relay_1_1nostr_1_1events_1_1incoming_1_1unknown__message_html"><div class="ttname"><a href="structradix__relay_1_1nostr_1_1events_1_1incoming_1_1unknown__message.html">radix_relay::nostr::events::incoming::unknown_message</a></div><div class="ttdoc">Received unknown/unrecognized message type.</div><div class="ttdef"><b>Definition</b> <a href="nostr_2include_2nostr_2events_8hpp_source.html#l00041">events.hpp:42</a></div></div>
<div class="ttc" id="astructradix__relay_1_1nostr_1_1events_1_1incoming_1_1unknown__protocol_html"><div class="ttname"><a href="structradix__relay_1_1nostr_1_1events_1_1incoming_1_1unknown__protocol.html">radix_relay::nostr::events::incoming::unknown_protocol</a></div><div class="ttdoc">Received unknown protocol message.</div><div class="ttdef"><b>Definition</b> <a href="nostr_2include_2nostr_2events_8hpp_source.html#l00059">events.hpp:60</a></div></div>
<div class="ttc" id="astructradix__relay_1_1nostr_1_1protocol_1_1event__data_html"><div class="ttname"><a href="structradix__relay_1_1nostr_1_1protocol_1_1event__data.html">radix_relay::nostr::protocol::event_data</a></div><div class="ttdoc">Nostr event data structure.</div><div class="ttdef"><b>Definition</b> <a href="protocol_8hpp_source.html#l00043">protocol.hpp:44</a></div></div>
<div class="ttc" id="astructradix__relay_1_1nostr_1_1protocol_1_1event__data_html_a3823414427e387f57de53756df87069d"><div class="ttname"><a href="structradix__relay_1_1nostr_1_1protocol_1_1event__data.html#a3823414427e387f57de53756df87069d">radix_relay::nostr::protocol::event_data::sig</a></div><div class="ttdeci">std::string sig</div><div class="ttdoc">Schnorr signature (64-byte hex)</div><div class="ttdef"><b>Definition</b> <a href="protocol_8hpp_source.html#l00051">protocol.hpp:51</a></div></div>
<div class="ttc" id="astructradix__relay_1_1nostr_1_1protocol_1_1event__data_html_a3fc5773052c6e3d3f64dccdbd2db0b98"><div class="ttname"><a href="structradix__relay_1_1nostr_1_1protocol_1_1event__data.html#a3fc5773052c6e3d3f64dccdbd2db0b98">radix_relay::nostr::protocol::event_data::id</a></div><div class="ttdeci">std::string id</div><div class="ttdoc">Event ID (32-byte hex hash)</div><div class="ttdef"><b>Definition</b> <a href="protocol_8hpp_source.html#l00045">protocol.hpp:45</a></div></div>
<div class="ttc" id="astructradix__relay_1_1nostr_1_1protocol_1_1event__data_html_ab3877bf983c769f85d3569c6aea5dcc1"><div class="ttname"><a href="structradix__relay_1_1nostr_1_1protocol_1_1event__data.html#ab3877bf983c769f85d3569c6aea5dcc1">radix_relay::nostr::protocol::event_data::content</a></div><div class="ttdeci">std::string content</div><div class="ttdoc">Event content.</div><div class="ttdef"><b>Definition</b> <a href="protocol_8hpp_source.html#l00050">protocol.hpp:50</a></div></div>
<div class="ttc" id="astructradix__relay_1_1nostr_1_1protocol_1_1event__data_html_ac6a51030983d7a3efcd120e99e1216bc"><div class="ttname"><a href="structradix__relay_1_1nostr_1_1protocol_1_1event__data.html#ac6a51030983d7a3efcd120e99e1216bc">radix_relay::nostr::protocol::event_data::pubkey</a></div><div class="ttdeci">std::string pubkey</div><div class="ttdoc">Public key of event creator (32-byte hex)</div><div class="ttdef"><b>Definition</b> <a href="protocol_8hpp_source.html#l00046">protocol.hpp:46</a></div></div>
<div class="ttc" id="astructradix__relay_1_1nostr_1_1protocol_1_1event__data_html_ad2c974dc92da18bd3987fb021c08cdda"><div class="ttname"><a href="structradix__relay_1_1nostr_1_1protocol_1_1event__data.html#ad2c974dc92da18bd3987fb021c08cdda">radix_relay::nostr::protocol::event_data::created_at</a></div><div class="ttdeci">std::uint64_t created_at</div><div class="ttdoc">Unix timestamp.</div><div class="ttdef"><b>Definition</b> <a href="protocol_8hpp_source.html#l00047">protocol.hpp:47</a></div></div>
<div class="ttc" id="astructradix__relay_1_1nostr_1_1protocol_1_1event__data_html_ad3bdd331d2c40833d6b27bb5a7716fb4"><div class="ttname"><a href="structradix__relay_1_1nostr_1_1protocol_1_1event__data.html#ad3bdd331d2c40833d6b27bb5a7716fb4">radix_relay::nostr::protocol::event_data::tags</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; std::string &gt; &gt; tags</div><div class="ttdoc">Event tags (arbitrary string arrays)</div><div class="ttdef"><b>Definition</b> <a href="protocol_8hpp_source.html#l00049">protocol.hpp:49</a></div></div>
<div class="ttc" id="astructradix__relay_1_1nostr_1_1protocol_1_1event_html_ae5eba508f6386bb9ec3aad35e88a6868"><div class="ttname"><a href="structradix__relay_1_1nostr_1_1protocol_1_1event.html#ae5eba508f6386bb9ec3aad35e88a6868">radix_relay::nostr::protocol::event::from_event_data</a></div><div class="ttdeci">static auto from_event_data(const event_data &amp;evt) -&gt; event</div><div class="ttdoc">Creates an event message from event_data.</div></div>
<div class="ttc" id="astructradix__relay_1_1nostr_1_1publish__bundle__result_html"><div class="ttname"><a href="structradix__relay_1_1nostr_1_1publish__bundle__result.html">radix_relay::nostr::publish_bundle_result</a></div><div class="ttdoc">Result of publishing a bundle to Nostr.</div><div class="ttdef"><b>Definition</b> <a href="message__handler_8hpp_source.html#l00027">message_handler.hpp:28</a></div></div>
<div class="ttc" id="astructradix__relay_1_1nostr_1_1publish__bundle__result_html_a06567c37b9b3f6336a4fb22f47c5f7c1"><div class="ttname"><a href="structradix__relay_1_1nostr_1_1publish__bundle__result.html#a06567c37b9b3f6336a4fb22f47c5f7c1">radix_relay::nostr::publish_bundle_result::event_id</a></div><div class="ttdeci">std::string event_id</div><div class="ttdoc">Nostr event ID.</div><div class="ttdef"><b>Definition</b> <a href="message__handler_8hpp_source.html#l00029">message_handler.hpp:29</a></div></div>
<div class="ttc" id="astructradix__relay_1_1nostr_1_1publish__bundle__result_html_a14e46ee80d285ac733d658dfc042eef0"><div class="ttname"><a href="structradix__relay_1_1nostr_1_1publish__bundle__result.html#a14e46ee80d285ac733d658dfc042eef0">radix_relay::nostr::publish_bundle_result::kyber_pre_key_id</a></div><div class="ttdeci">std::uint32_t kyber_pre_key_id</div><div class="ttdoc">Kyber prekey ID used.</div><div class="ttdef"><b>Definition</b> <a href="message__handler_8hpp_source.html#l00033">message_handler.hpp:33</a></div></div>
<div class="ttc" id="astructradix__relay_1_1nostr_1_1publish__bundle__result_html_a43c10fe0c6b8cbc0c45c0a33d8f9d9e1"><div class="ttname"><a href="structradix__relay_1_1nostr_1_1publish__bundle__result.html#a43c10fe0c6b8cbc0c45c0a33d8f9d9e1">radix_relay::nostr::publish_bundle_result::pre_key_id</a></div><div class="ttdeci">std::uint32_t pre_key_id</div><div class="ttdoc">One-time prekey ID used.</div><div class="ttdef"><b>Definition</b> <a href="message__handler_8hpp_source.html#l00031">message_handler.hpp:31</a></div></div>
<div class="ttc" id="astructradix__relay_1_1nostr_1_1publish__bundle__result_html_a5235a454dc24193251da6682822bbbce"><div class="ttname"><a href="structradix__relay_1_1nostr_1_1publish__bundle__result.html#a5235a454dc24193251da6682822bbbce">radix_relay::nostr::publish_bundle_result::signed_pre_key_id</a></div><div class="ttdeci">std::uint32_t signed_pre_key_id</div><div class="ttdoc">Signed prekey ID used.</div><div class="ttdef"><b>Definition</b> <a href="message__handler_8hpp_source.html#l00032">message_handler.hpp:32</a></div></div>
<div class="ttc" id="astructradix__relay_1_1nostr_1_1publish__bundle__result_html_aa1a52150045908833b9d557a7b741d9d"><div class="ttname"><a href="structradix__relay_1_1nostr_1_1publish__bundle__result.html#aa1a52150045908833b9d557a7b741d9d">radix_relay::nostr::publish_bundle_result::bytes</a></div><div class="ttdeci">std::vector&lt; std::byte &gt; bytes</div><div class="ttdoc">Serialized event bytes.</div><div class="ttdef"><b>Definition</b> <a href="message__handler_8hpp_source.html#l00030">message_handler.hpp:30</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li><li class="navelem"><a class="el" href="dir_d25976cbcdc1f52d3996a1ea39506886.html">nostr</a></li><li class="navelem"><a class="el" href="dir_9b9128f3a6fc200e052795d18bcb8ff2.html">include</a></li><li class="navelem"><a class="el" href="dir_f1e1b06a733ff25bd112953fe1d6bc71.html">nostr</a></li><li class="navelem"><a class="el" href="message__handler_8hpp.html">message_handler.hpp</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
